주요 요약
연구에 따르면, 대기 노드를 시작할 때 펜싱이 발생할 가능성이 높습니다. 이는 클러스터 상태 확인, 자원 충돌 방지, 구성 오류, 펜싱 토폴로지, 타이밍 문제로 인해 발생할 수 있습니다.  
이 주제는 복잡하며, 특정 구성에 따라 결과가 달라질 수 있습니다.
클러스터 상태 확인
대기 노드가 시작될 때, 클러스터는 모든 노드의 상태를 확인하여 일관된 상태를 유지하려고 합니다. 상태가 불확실하면 펜싱이 발생할 수 있습니다. 이는 특히 스플릿 브레인 시나리오를 방지하기 위해 중요합니다.  
자원 충돌 방지
액티브 노드가 이미 공유 자원을 사용 중일 때, 대기 노드가 시작되면 클러스터는 자원 충돌을 방지하기 위해 펜싱을 실행할 수 있습니다. 이는 데이터 손상이나 불일치를 방지하기 위한 안전 장치입니다.  
구성 오류
STONITH 설정이나 자원 제약 조건이 잘못 구성되었을 경우, 대기 노드가 클러스터에 합류할 때 펜싱이 트리거될 수 있습니다. 예를 들어, STONITH 호스트 목록이 비어 있거나 노드가 포함되지 않으면 펜싱 문제가 발생할 수 있습니다.  
펜싱 토폴로지
펜싱 장치와 레벨이 올바르게 설정되지 않으면, 새로운 노드가 클러스터에 합류할 때 펜싱이 발생할 수 있습니다. 이는 펜싱 토폴로지의 구성 방식에 따라 달라질 수 있습니다.  
타이밍 문제
대기 노드가 시작되는 타이밍이 맞지 않으면, 예를 들어 액티브 노드가 완전히 초기화되기 전에 시작되면, 클러스터는 이를 불일치 상태로 간주하고 펜싱을 트리거할 수 있습니다.  
상세 보고서
이 보고서는 SUSE Linux Enterprise High Availability (SLE HA) 12에서 Pacemaker를 사용하는 활성-대기(active-standby) 설정에서, 활성 노드가 이미 실행 중인 상황에서 대기 노드를 늦게 시작할 때 펜싱(fencing)이 발생하는 이유를 조사합니다. 이 섹션은 전문적인 문서 스타일로 작성되었으며, 사용자의 질문에 대한 모든 세부 정보를 포함합니다.
배경 및 맥락
Pacemaker는 고가용성 클러스터를 관리하는 소프트웨어로, 여러 노드에서 서비스 무결성을 유지하고 다운타임을 최소화합니다. 활성-대기 설정에서는 한 노드(활성)가 공유 자원을 관리하고, 다른 노드(대기)는 예비로 대기하며, 활성 노드가 실패하면 대기 노드가 이를 인계합니다. 펜싱은 STONITH("Shoot The Other Node In The Head")로 알려진 메커니즘으로, 고장 난 노드를 격리하여 데이터 손상이나 스플릿 브레인(split-brain) 시나리오를 방지합니다.
사용자의 시나리오에서는 활성 노드가 이미 실행 중인 상태에서 대기 노드를 늦게 시작하면 펜싱이 발생합니다. 이는 클러스터의 상태 관리, 자원 충돌 방지, 구성 오류, 펜싱 토폴로지, 타이밍 문제와 관련될 수 있습니다.
펜싱 발생 이유 분석
다음은 펜싱이 발생할 수 있는 주요 이유와 관련 세부 사항입니다:
클러스터 상태 확인  
대기 노드가 시작될 때, 클러스터는 모든 노드의 상태를 확인하여 일관된 상태를 유지하려고 합니다. 상태가 불확실하면 펜싱이 트리거될 수 있습니다.  
이는 특히 스플릿 브레인 시나리오를 방지하기 위해 중요하며, 두 노드가 동시에 활성 상태로 간주되지 않도록 합니다.  
예를 들어, 대기 노드가 클러스터에 합류할 때, 클러스터는 노드의 이전 상태를 확인하고, 불일치가 감지되면 펜싱을 실행할 수 있습니다.  
관련 문서: Pacemaker Explained: Fencing
자원 충돌 방지  
활성-대기 설정에서 공유 자원(예: 스토리지, IP 주소)은 일반적으로 활성 노드에서만 활성화됩니다. 대기 노드가 시작되면, 클러스터는 이 자원에 접근하려는 시도를 감지하고 펜싱을 통해 충돌을 방지할 수 있습니다.  
이는 데이터 손상이나 불일치를 방지하기 위한 안전 장치로, 특히 자원 제약 조건이 잘못 설정되었을 때 발생할 가능성이 높습니다.  
예를 들어, 대기 노드가 잘못 구성되어 공유 자원에 접근하려고 하면, 클러스터는 펜싱을 트리거하여 노드를 격리할 수 있습니다.  
관련 문서: SLE HA 12 SP5 Administration Guide: Fencing and STONITH
구성 오류  
STONITH 설정이나 자원 제약 조건이 잘못 구성되었을 경우, 대기 노드가 클러스터에 합류할 때 펜싱이 트리거될 수 있습니다.  
예를 들어, STONITH 호스트 목록이 비어 있거나 대기 노드가 포함되지 않으면, 클러스터는 펜싱 장치를 찾지 못하고 타임아웃이 발생할 수 있습니다. 이는 펜싱 실패로 이어질 수 있습니다.  
또한, 펜싱 장치가 노드를 펜싱해야 하는 노드에서 실행되지 않도록 설정해야 합니다. 예를 들어, 무한히 음수인 위치 노드 선호도를 사용하여 펜싱 장치가 대상 노드에서 실행되지 않도록 해야 합니다.  
관련 문서: SLE HA 12 SP5 Administration Guide: Troubleshooting
펜싱 토폴로지  
Pacemaker는 여러 펜싱 장치와 레벨(예: Level 1, Level 2)을 지원합니다. 펜싱 토폴로지가 올바르게 설정되지 않으면, 새로운 노드가 클러스터에 합류할 때 펜싱이 발생할 수 있습니다.  
예를 들어, 펜싱 레벨이 잘못 설정되어 대기 노드가 시작될 때 불필요한 펜싱이 트리거될 수 있습니다.  
관련 문서: Pacemaker Explained: Fencing
타이밍 문제  
대기 노드가 시작되는 타이밍이 맞지 않으면, 예를 들어 활성 노드가 완전히 초기화되기 전에 시작되면, 클러스터는 이를 불일치 상태로 간주하고 펜싱을 트리거할 수 있습니다.  
이는 클러스터의 쿼럼 계산이나 노드 통신이 지연될 때 발생할 수 있으며, 클러스터가 예방 조치를 취하도록 유도할 수 있습니다.  
관련 문서: Red Hat Customer Portal: Pacemaker Fencing Issue
기본 펜싱 동작  
Pacemaker의 기본 동작에는 startup-fencing 옵션이 포함되어 있으며, 이는 클러스터 시작 시 상태가 알려지지 않은 노드를 펜싱합니다. 대기 노드가 늦게 시작되면, 클러스터는 이를 상태가 알려지지 않은 노드로 간주하고 펜싱을 실행할 수 있습니다.  
이는 클러스터 무결성을 유지하기 위한 안전 장치입니다.  
관련 문서: SLE HA 12 SP5 Administration Guide: Fencing and STONITH
추가 고려 사항
활성-대기 설정에서 사용되는 프로모터블 클론(promotable clones)은 마스터/슬레이브 모드로 작동하며, 노드가 프로모션되거나 데모션될 때 펜싱이 관련될 수 있습니다. 그러나 특정 문서에서는 펜싱이 프로모터블 클론과 직접적으로 연결되지 않음을 명시합니다.  
SUSE HA 12에서 알려진 문제나 버그가 있을 수 있으며, 이는 펜싱이 발생하는 원인이 될 수 있습니다. 그러나 특정 사례는 문서화되지 않았습니다.  
펜싱 문제 해결을 위해 로그 파일을 확인하는 것이 중요합니다. 예를 들어, /var/log/messages나 Pacemaker 로그를 통해 펜싱 실패 원인을 파악할 수 있습니다.
표: 펜싱 관련 구성 옵션
다음 표는 펜싱과 관련된 중요한 인스턴스 속성을 요약한 것입니다. 이는 활성-대기 설정에서 펜싱 문제를 해결하는 데 유용할 수 있습니다.
이름
유형
기본값
설명
pcmk_delay_max
기간
0s
펜싱 동작 전 최대 지연 시간, 특히 2노드 클러스터(예: 활성-대기)에서 동시 펜싱 방지
pcmk_delay_base
텍스트
0s
펜싱 동작 전 정적 지연 시간, 노드별로 호스트 맵을 통해 구성 가능 (2.1.2부터)
pcmk_action_limit
정수
1
최대 병렬 동작 수, -1로 설정하면 무제한, concurrent-fencing 속성에 영향을 받음
결론
펜싱은 활성-대기 설정에서 클러스터 무결성을 유지하기 위한 필수 메커니즘입니다. 대기 노드가 늦게 시작될 때 펜싱이 발생하는 이유는 클러스터 상태 확인, 자원 충돌 방지, 구성 오류, 펜싱 토폴로지, 타이밍 문제, 기본 펜싱 동작과 관련될 수 있습니다. 특정 구성과 환경에 따라 결과가 달라질 수 있으므로, 로그 분석과 구성 검토를 통해 문제를 해결하는 것이 권장됩니다.
주요 인용
Pacemaker Explained: Fencing  
SLE HA 12 SP5 Administration Guide: Fencing and STONITH  
SLE HA 12 SP5 Administration Guide: Troubleshooting  
Red Hat Customer Portal: Pacemaker Fencing Issue
